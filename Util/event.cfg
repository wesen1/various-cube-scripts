//
// @author wesen
// @copyright 2021 wesen <wesen-ac@web.de>
//

const uppercase_first [
  targetString = $arg1;
  return (concatword (toupper (substr $targetString 0 1)) (substr $targetString 1));
]


const initializeEvent [

  eventName = $arg1;
  eventHandlerFunctionName = (getEventHandlerFunctionName $eventName);

  checkinit $eventHandlerFunctionName []

]

const addEventHandler [

  eventName = $arg1;
  eventHandlerFunction = $arg2;

  eventHandlerFunctionName = (getEventHandlerFunctionName $eventName);

  checkinit $eventHandlerFunctionName [
    if (= (call_anonymous_func_array $return) 0) [
      $eventHandlerFunction;
    ]
  ]

]

const fireEvent [

  eventName = $arg1;

  eventHandlerFunctionArguments = (array_slice (getFunctionArguments $numargs) " " 1);

  eventHandlerFunctionName = (getEventHandlerFunctionName $eventName);
  return (call_user_func_array $eventHandlerFunctionName $eventHandlerFunctionArguments);
]


const getEventHandlerFunctionName [
  return (concatword "on" (uppercase_first $arg1));
]


addEventHandler "test" [ echo $arg1; return 0 ];
addEventHandler "test" [ return $arg1 ];


const callTestEventHandler [
  echo (fireEvent "test" 5);
]


addEventHandler "test2" [ echo $arg1; return "stopit" ];
addEventHandler "test2" [ return "ididntstop" ];


const callTestEventHandler2 [
  echo (fireEvent "test2" 5);
]
